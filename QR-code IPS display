/*______________________________
      
       100% Marinaat Warez
  ______________________________

  project: QR CODE DISPLAY
  startdate: 21/11/2020 
 
  240x240 IPS DISPLAY CONNECTIONS:
  GND-GND | VCC-5V | SCL-13 | SDA-11 | RES-8 | DC-9 | BLK-5V
*/

#include "qrcode.h"
#include <Adafruit_ST7789.h> // Hardware-specific library for ST7789 display

/* display pins */
#define TFT_CS    10  // define chip select pin
#define TFT_DC     9  // define data/command pin
#define TFT_RST    8  // define reset pin, or set to -1 and connect to Arduino RESET pin
 
/*Initialize Adafruit ST7789 TFT library */
Adafruit_ST7789 tft = Adafruit_ST7789(TFT_CS, TFT_DC, TFT_RST);

/* define different QR codes */
String qr1 ="www.mariokuijpers.com";
String qr2="www.tweakers.net";
String qr3="www.nu.nl";
String qr4="www.facebook.com";
String qr5="www.twitter.com";
String qr6="www.google.nl";
String qr7="www.gmail.com";
String qr8="www.dumpert.nl";
String qr9="www.youtube.com";
String qr10="www.googlemaps.com";

QRCode qrcode;
String url ="";

void setup(void) {
 tft.init(240, 240, SPI_MODE2);  // Init ST7789 display 240x240 pixel
 tft.setRotation(2); 
 tft.setTextColor(ST77XX_WHITE);
}

void generateQRCode(int qrnr) {
  
  /*determine which QR code to display and generate it
    switch needed for I2C implemantation in future
  */
  switch (qrnr) {
    case 1:
      url = qr1;
    break;
    case 2:
      url = qr2;
    break;
    case 3:
      url = qr3;
    break;
    case 4:
      url = qr4;
    break;
    case 5:
      url = qr5;
    break;
    case 6:
      url = qr6;
    break;
    case 7:
      url = qr7;
    break;
    case 8:
      url = qr8;
    break;
    case 9:
      url = qr9;
    break;
    case 10:
      url = qr10;
    break;
  } 
  uint8_t qrcodeData[qrcode_getBufferSize(3)];
  qrcode_initText(&qrcode, qrcodeData, 3, 0, url.c_str());
  
  /* send QR code to display */
  tft.fillScreen(ST77XX_BLACK);
  int offsetX = 0;
  int offsetY = 0;
  for (uint8_t y = 0; y < qrcode.size; y++) {
    offsetX = 0;
      for (uint8_t x = 0; x < qrcode.size; x++) {
        if (qrcode_getModule(&qrcode, x, y)) {
          tft.drawRect(x + offsetX, y + offsetY, 8, 8, ST77XX_WHITE);
          tft.fillRect(x + offsetX, y + offsetY, 8, 8, ST77XX_WHITE);
        }
        offsetX+=7;
      }
      offsetY+=7;
  }
}

void loop() {
  /* Use simple loop for now to display all codes */
  for (int i = 0; i <= 10; i++) {
    generateQRCode(i);
    delay (1000);
  } 
}
